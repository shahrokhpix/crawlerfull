# تست استرس سیستم

این پوشه شامل مجموعه‌ای از تست‌های استرس برای ارزیابی عملکرد و پایداری سیستم است.

## فایل‌های موجود

### 1. `stress-test.js`
تست استرس اصلی با قابلیت‌های زیر:
- تست کاربران همزمان
- تست کرال همزمان
- تست استرس دیتابیس
- تست استرس حافظه
- تست API های مدیریتی
- تست Load Balancer
- تست WebSocket
- تست Circuit Breaker

### 2. `advanced-stress-test.js`
تست استرس پیشرفته با قابلیت‌های اضافی:
- تست Rate Limiting
- تست Connection Pool
- تست عملکرد سیستم
- تست شبکه
- Monitoring پیشرفته

### 3. `quick-test.js`
تست سریع برای بررسی سلامت سیستم:
- Health Check
- اتصال دیتابیس
- API Endpoints
- استفاده حافظه
- وضعیت پایداری

### 4. `run-stress-test.sh` (Linux/Mac)
اسکریپت اجرای تست استرس در سیستم‌های Unix

### 5. `run-stress-test.bat` (Windows)
اسکریپت اجرای تست استرس در Windows

## نحوه اجرا

### پیش‌نیازها
```bash
npm install axios ws
```

### اجرای تست ساده
```bash
# Linux/Mac
./run-stress-test.sh

# Windows
run-stress-test.bat

# یا مستقیماً
node stress-test.js
```

### اجرای تست پیشرفته
```bash
node advanced-stress-test.js
```

### اجرای تست سریع
```bash
node quick-test.js
```

## گزینه‌های تست

### تست کامل استرس
```bash
node stress-test.js --full
```

### تست‌های جداگانه
```bash
# تست کرال همزمان
node stress-test.js --crawl

# تست استرس دیتابیس
node stress-test.js --database

# تست استرس حافظه
node stress-test.js --memory

# تست API های مدیریتی
node stress-test.js --admin

# تست Load Balancer
node stress-test.js --load-balancer

# تست WebSocket
node stress-test.js --websocket

# تست Circuit Breaker
node stress-test.js --circuit-breaker
```

## تنظیمات تست

### تنظیمات پیش‌فرض
```javascript
{
  concurrentUsers: 50,        // تعداد کاربران همزمان
  requestsPerUser: 100,       // درخواست‌ها به ازای هر کاربر
  delayBetweenRequests: 100,  // تاخیر بین درخواست‌ها (ms)
  testDuration: 300000        // مدت زمان تست (ms)
}
```

### تنظیمات پیشرفته
```javascript
{
  concurrentUsers: 100,       // تعداد کاربران همزمان بیشتر
  requestsPerUser: 200,       // درخواست‌های بیشتر
  delayBetweenRequests: 50,   // تاخیر کمتر
  testDuration: 600000,       // مدت زمان بیشتر
  rateLimitThreshold: 1000,   // آستانه Rate Limit
  connectionPoolSize: 50      // اندازه Connection Pool
}
```

## نتایج تست

### فایل‌های خروجی
- `stress-test-results-{timestamp}.json` - نتایج کامل تست استرس
- `advanced-stress-test-results-{timestamp}.json` - نتایج تست پیشرفته
- `stress-test-errors-{timestamp}.json` - خطاهای رخ داده

### متریک‌های اندازه‌گیری شده
- تعداد کل درخواست‌ها
- درخواست‌های موفق و ناموفق
- نرخ موفقیت
- میانگین زمان پاسخ
- استفاده حافظه
- استفاده CPU
- آمار شبکه
- آمار Rate Limiting
- آمار Connection Pool

## تحلیل نتایج

### نرخ موفقیت
- **عالی**: > 95%
- **خوب**: 90-95%
- **متوسط**: 80-90%
- **ضعیف**: < 80%

### زمان پاسخ
- **عالی**: < 100ms
- **خوب**: 100-500ms
- **متوسط**: 500-1000ms
- **ضعیف**: > 1000ms

### استفاده حافظه
- **بهینه**: < 512MB
- **قابل قبول**: 512MB-1GB
- **نیاز به بهینه‌سازی**: > 1GB

## نکات مهم

### قبل از اجرای تست
1. اطمینان از اجرای سرور اصلی
2. بررسی اتصال دیتابیس
3. پاک‌سازی لاگ‌های قبلی
4. بررسی منابع سیستم

### حین اجرای تست
1. نظارت بر استفاده CPU و حافظه
2. بررسی لاگ‌های سرور
3. نظارت بر اتصالات دیتابیس
4. بررسی وضعیت شبکه

### بعد از اجرای تست
1. تحلیل نتایج
2. بررسی خطاها
3. بهینه‌سازی در صورت نیاز
4. ذخیره نتایج برای مقایسه

## عیب‌یابی

### مشکلات رایج

#### خطای اتصال
```
❌ خطا در اتصال به سرور
```
**راه حل**: بررسی اجرای سرور و پورت

#### خطای دیتابیس
```
❌ خطا در اتصال دیتابیس
```
**راه حل**: بررسی تنظیمات دیتابیس و اتصال

#### خطای حافظه
```
❌ خطا در تخصیص حافظه
```
**راه حل**: کاهش تعداد کاربران همزمان

#### خطای Timeout
```
❌ خطای Timeout در درخواست
```
**راه حل**: افزایش timeout یا کاهش بار

## توسعه

### اضافه کردن تست جدید
1. ایجاد کلاس تست جدید
2. پیاده‌سازی متدهای مورد نیاز
3. اضافه کردن به فایل اصلی
4. به‌روزرسانی اسکریپت‌های اجرا

### سفارشی‌سازی تنظیمات
1. ویرایش `testConfig` در کلاس تست
2. تنظیم پارامترهای مورد نیاز
3. تست با تنظیمات جدید

## پشتیبانی

برای گزارش مشکلات یا پیشنهادات:
1. بررسی لاگ‌های خطا
2. جمع‌آوری اطلاعات سیستم
3. گزارش دقیق مشکل
4. ارائه راه‌حل پیشنهادی 